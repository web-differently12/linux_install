---
- hosts: kali

  tasks:
    - name: Update and upgrade apt packages
      become: true
      apt:
        upgrade: yes
        update_cache: yes
        cache_valid_time: 86400 #One day

    - name: Download arm vscode
      get_url: 
        url: "https://code.visualstudio.com/sha/download?build=stable&os=linux-deb-arm64" 
        dest: "/tmp/vscode.deb"
      when: ansible_architecture == 'aarch64' or ansible_architecture == 'arm64'

    - name: Download x64 vscode
      get_url: 
        url: "https://code.visualstudio.com/sha/download?build=stable&os=x64" 
        dest: "/tmp/vscode.deb"
      when: ansible_architecture != 'aarch64' and ansible_architecture != 'arm64'

    - name: Install VSCode
      become: true
      apt:
        deb: /tmp/vscode.deb

    - name: Install packages
      become: true
      apt:
        name: 
          - ncdu
          - terminator
          - seclists
          - feroxbuster
          - gobuster
          - python3-pip
          - python3.11-venv
        state: present

    - name: Create terminator config folder
      file:
        path: "~/.config/terminator"
        state: directory

    - name: Copy terminator config file
      copy:
        src: "terminator_config"
        dest: "~/.config/terminator/config"

    - name: Unpack rockyou
      become: true
      shell: gunzip -d /usr/share/wordlists/rockyou.txt.gz
      ignore_errors: yes

    - name: Copy .zshrc
      copy:
        src: ".zshrc"
        dest: "~/.zshrc"

    - name: Add pipx path
      lineinfile:
        dest: "~/.zshrc"
        line: 'export PATH="$PATH:/home/kali/.local/bin"'

    - name: Install pwncat-cs
      shell: |
        python3 -m pip install --user pipx
        export PATH="$PATH:/home/kali/.local/bin"
        pipx install pwncat-cs

    - name: Setting VIM
      become: true
      copy:
        dest: "{{ item }}"
        content: |
          source $VIMRUNTIME/defaults.vim
          set mouse-=a
      with_items:
        - /home/kali/.vimrc
        - /root/.vimrc

    - name: Copy scripts
      become: true
      copy:
        src: "{{ item }}"
        dest: "/usr/local/bin/"
        mode: "+x"
      with_items:
        - "upload"
        - "monip"
        - "nmaper"
        - "vpnchoice"
    
    - name: Install simple-term-menu
      become: true
      shell: python3 -m pip install simple-term-menu

    - name: Copy arm burpsuite script
      become: true
      copy:
        src: "burpsuite"
        dest: "/usr/local/bin/"
        mode: "+x"
      when: ansible_architecture == 'aarch64' or ansible_architecture == 'arm64'
    
    - name: Install arm burpsuite
      become: true
      shell: /usr/local/bin/burpsuite -u
      when: ansible_architecture == 'aarch64' or ansible_architecture == 'arm64'

    - name: Create Tools folder
      file:
        path: "~/Tools"
        state: directory

    - name: Get Tools script
      get_url: 
        url: "https://raw.githubusercontent.com/ThePorgs/Exegol-resources/main/update-resources.sh" 
        dest: "~/Tools/"
        mode: "+x"

    - name: Install Tools
      shell: |
        cd ~/Tools/
        ./update-resources.sh